#  Gazebo Franka ROS1 

## Cloning
```sh
git clone --recurse-submodules git@gitlab.lrz.de:tum-impl-ss24/gazebo_franka_ros1.git
```


## Setup
Modify the `.env` file replacing
- `<username>` with your username (i.e., the output of `whoami` in your terminal) in `USERNAME=<username>`
- `<username>` with your username in `ROS_WS=/home/<username>/ros_ws` (`ROS_WS` will be the path of your ROS2 workspace in the container)

> Reason: these variables are used to setup the container user with same credential of the host (by default the container would run as superuser). Among several benefits, this implies that all the files generated by the container have the same ownership of the one generated by the host. For further info, refer to this [guide][dockerROS2guide].   

At the first usage, build the docker image using the following command in the project folder:
```sh
docker compose build
```

## Usage
Open a terminal in the project folder and run:
```sh
docker compose up
```
Now a docker container is running on your machine. To access the container, open another terminal and run:
```sh
docker compose exec -it gazebo_franka_ros1-ros1_node-1 bash
```
> this is the equivalent of opening a terminal on your Ubuntu installation but on the Ubuntu installation running in the container. 

where `gazebo_franka_ros1-ros1_node-1` is the name of the container you want to access. To see the names of all the container running on your machine, you can use `docker ps`.

## Start Gazebo simulation with Franka Robot arm
Start simulation with robot arm:
```sh
roslaunch franka_gazebo panda.launch x:=-0.5 \
    controller:=cartesian_impedance_example_controller \
    use_gripper:=false\
    rviz:=true
```
Start simulation with robot arm with pick-and-place setup:
```sh
roslaunch franka_gazebo panda.launch x:=-0.5 \
    world:=$(rospack find demo_pkg)/world/pick_place.sdf \
    controller:=cartesian_impedance_example_controller \
    rviz:=true
```
## Developing with VS code
Requirements:
- dev container extension in VS code

First, build and run the dockerimage:
```sh
docker compose up
```
To read the name of the container just created, run:
```sh
docker ps
```

Now, open VS code, and: 
- select in the menu `ctrl+P` the option:  _attach to container_
- choose the container to attach 

# Activate IntelliSense
- In `~/ros_ws`, run 
```sh
colcon build --cmake-args -DCMAKE_EXPORT_COMPILE_COMMANDS=ON
```
- In VScode, open the `c_cpp_properties.json` in `.vscode` folder, and paste the following:
```sh
{
    "configurations": [
      {
        "browse": {
          "databaseFilename": "${default}",
          "limitSymbolsToIncludedHeaders": false
        },
        "defines": [],
        "includePath": [],
        "compileCommands": "${workspaceFolder}/build/compile_commands.json",
        "name": "ROS",
        "intelliSenseMode": "linux-gcc-x64",
        "compilerPath": "/usr/bin/gcc",
        "cStandard": "gnu11",
        "cppStandard": "c++17"
      }
    ],
    "version": 4
  } 
```
## Build a package
In src folder, run:
```sh
catkin_make 
```
## Troubleshooting



## License

MIT Â© [Alessandro Melone](https://alessandromelone.github.io/) alessandro.melone@tum.de

[//]: # (These are reference links used in the body of this note and get stripped out when the markdown processor does its job. There is no need to format nicely because it shouldn't be seen. Thanks SO - http://stackoverflow.com/questions/4823468/store-comments-in-markdown-syntax)

   [git-repo-tinyfsm]: <https://github.com/joemccann/dillinger>
